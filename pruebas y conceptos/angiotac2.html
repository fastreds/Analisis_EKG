<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Dinámico de Reporte AngioTC Cardiaco</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="container mx-auto max-w-4xl bg-white p-6 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold mb-4 text-center">Reporte de Tomografía Computarizada Cardiaca con Multidetector</h1>
        
        <!-- Botones de Precarga y Exportación -->
        <div class="flex justify-between mb-4">
            <button id="preload-normal" class="bg-blue-500 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-blue-600">Precargar Escenario Normal</button>
            <button id="preload-severe" class="bg-red-500 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-red-600">Precargar Escenario Severo</button>
            <button id="generate-pdf" class="bg-green-500 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-green-600">Generar PDF</button>
        </div>
        
        <!-- Vista Previa del Reporte -->
        <div id="preview" class="border border-gray-300 p-4 mb-4 rounded-lg bg-white"></div>
        
        <!-- Formulario Dinámico -->
        <form id="report-form" class="space-y-6"></form>
    </div>

    <script>
        // JSON Flexible que describe las secciones del informe
        const reportStructure = {
            sections: [
                {
                    title: "Datos del Paciente",
                    fields: [
                        { name: "nombre", label: "Nombre", type: "text" },
                        { name: "identificacion", label: "Identificación", type: "text" },
                        { name: "genero", label: "Género", type: "select", options: ["MASCULINO", "FEMENINA"] },
                        { name: "edad", label: "Edad (Años)", type: "number" },
                        { name: "peso", label: "Peso (Kg)", type: "number" },
                        { name: "talla", label: "Talla (CM)", type: "number" },
                        { name: "area_sc", label: "Área SC (m²)", type: "number" },
                        { name: "fecha_estudio", label: "Fecha del Estudio", type: "date" },
                        { name: "medico_refiere", label: "Médico que Refiere", type: "text" }
                    ]
                },
                {
                    title: "Métodos del Estudio",
                    fields: [
                        { name: "tomografo", label: "Tomógrafo", type: "text", default: "Canon Aquilion® 160 cortes" },
                        { name: "tiempo_rotacion", label: "Tiempo de Rotación", type: "text", default: "0.5/seg" },
                        { name: "ecg_gating", label: "ECG-gating", type: "text", default: "Retrospectivo (variabilidad FC respiratoria marcada)" },
                        { name: "medio_contraste", label: "Medio Contraste", type: "text", default: "Ultravist 370" },
                        { name: "volumen_contraste", label: "Volumen de Medio Contraste (ml)", type: "number", default: 85 },
                        { name: "velocidad_infusion", label: "Velocidad de Infusión (ml/s)", type: "number", default: 5 },
                        { name: "ritmo_estudio", label: "Ritmo durante el Estudio", type: "text", default: "Ritmo bradicardia sinusal" }
                    ]
                },
                {
                    title: "Motivo de Estudio y Generalidades",
                    fields: [
                        { name: "motivo", label: "Descripción de la Referencia", type: "textarea" },
                        { name: "consentimiento", label: "Consentimiento Informado", type: "checkbox", labelText: "Firmado" },
                        { name: "tolerancia", label: "Tolerancia al Estudio", type: "text", default: "Buena tolerancia al estudio, sin reacciones adversas al medio contraste." },
                        { name: "fc", label: "FC durante el Estudio", type: "text", default: "Paciente con FC de 45-55 lpm durante el estudio. Se utilizó una dosis de nitroglicerina sublingual." },
                        { name: "analisis", label: "Análisis de Imágenes", type: "text", default: "Análisis de imágenes fue por medio de estación de trabajo Vitrea®, todas las mediciones finales incluyendo cortes multiplanares y reconstrucción 3D." },
                        { name: "calidad", label: "Calidad de Estudio", type: "select", options: ["Buena", "Aceptable", "Limitada"] }
                    ]
                },
                {
                    title: "Anatomía Cardiovascular",
                    fields: [
                        { name: "venas_cavas", label: "Venas Cavas", type: "text", default: "Ambas no dilatadas drenando en la aurícula derecha" },
                        { name: "auricula_derecha", label: "Aurícula Derecha", type: "text", default: "No dilatada" },
                        { name: "septum_interauricular", label: "Septum Interauricular", type: "text", default: "No se visualizan defectos" },
                        { name: "seno_coronario", label: "Seno Coronario", type: "text", default: "Drenando a la AD en forma habitual sin dilatación o anomalías" },
                        { name: "valvula_tricuspide", label: "Válvula Tricúspide", type: "text", default: "No se visualizan defectos por este método" },
                        { name: "ventriculo_derecho", label: "Ventrículo Derecho", type: "text", default: "No dilatado ni hipertrófico" },
                        { name: "arteria_pulmonar", label: "Arteria Pulmonar", type: "text", default: "Diámetro Normal" },
                        { name: "venas_pulmonares", label: "Venas Pulmonares", type: "text", default: "Cuatro drenando a la aurícula izquierda, dos derechas y dos izquierdas" },
                        { name: "auricula_izquierda", label: "Aurícula Izquierda", type: "text", default: "No se observan trombos en la orejuela izquierda, ni masas o lesiones intracardiacas." },
                        { name: "ventriculo_izquierdo", label: "Ventrículo Izquierdo", type: "text", default: "No dilatado con hipertrofia concéntrica leve. Motilidad global y regional conservada. FEVI normal 70%." },
                        { name: "hallazgos_extracardiacos", label: "Hallazgos Extracardiacos", type: "text", default: "Hernia hiatal pequeña" }
                    ]
                },
                {
                    title: "Válvula Aórtica",
                    fields: [
                        { name: "cuspides", label: "Cúspides", type: "text", default: "3 cúspides de conformación Normal" },
                        { name: "calcificaciones_valvula", label: "Calcificaciones", type: "text" },
                        { name: "morfologia_anillo", label: "Morfología del Anillo Aórtico", type: "select", options: ["Elíptica", "Circular"] },
                        { name: "diametro_menor_anillo", label: "Diámetro Menor del Anillo (mm)", type: "number" },
                        { name: "diametro_mayor_anillo", label: "Diámetro Mayor del Anillo (mm)", type: "number" }
                    ]
                },
                {
                    title: "Diámetros de la Aorta",
                    fields: [
                        { name: "senos_valsalva_diametro", label: "Senos de Valsalva (mm)", type: "number" },
                        { name: "senos_valsalva_indexado", label: "Senos de Valsalva Indexado (mm/m² SC)", type: "number" },
                        { name: "senos_valsalva_observaciones", label: "Observaciones Senos de Valsalva", type: "text", default: "NORMAL" },
                        { name: "union_sinotubular_diametro", label: "Unión Sinotubular (mm)", type: "number" },
                        { name: "union_sinotubular_indexado", label: "Unión Sinotubular Indexado (mm/m² SC)", type: "number" },
                        { name: "union_sinotubular_observaciones", label: "Observaciones Unión Sinotubular", type: "text", default: "NORMAL" },
                        { name: "tubular_ascendente_diametro", label: "Porción Tubular Ascendente (mm)", type: "number" },
                        { name: "tubular_ascendente_indexado", label: "Porción Tubular Ascendente Indexado (mm/m² SC)", type: "number" },
                        { name: "tubular_ascendente_observaciones", label: "Observaciones Porción Tubular Ascendente", type: "text", default: "NORMAL (medición a 40 mm del anillo aórtico)" }
                    ]
                },
                {
                    title: "Score de Calcio Coronario",
                    fields: [
                        { name: "calcio_total", label: "Total (Agatston)", type: "number", default: 0 },
                        { name: "calcio_tci", label: "TCI", type: "number", default: 0 },
                        { name: "calcio_ada", label: "ADA", type: "number", default: 0 },
                        { name: "calcio_acd", label: "ACD", type: "number", default: 0 },
                        { name: "calcio_acx", label: "ACX", type: "number", default: 0 }
                    ]
                },
                {
                    title: "Arteriografía Coronaria No Invasiva - Arteria Coronaria Izquierda",
                    fields: [
                        { name: "tci_longitud", label: "Tronco Coronario Izquierdo - Longitud (mm)", type: "number", default: 13 },
                        { name: "tci_nacimiento", label: "Nacimiento", type: "text", default: "0% POR DIÁMETRO 0% POR ÁREA LUMINAL MÍNIMA" },
                        { name: "tci_ateromatosis", label: "Ateromatosis", type: "text" },
                        { name: "tci_compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                        { name: "tci_obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                        { name: "tci_termina_en", label: "Termina en", type: "text" },
                        { name: "tci_artefacto", label: "Presencia de Artefacto", type: "text" }
                    ],
                    repeatableGroups: [
                        {
                            groupName: "ada_segments",
                            title: "Arteria Descendente Anterior (ADA) - Segmentos",
                            repeatable: true,
                            fields: [
                                { name: "segmento", label: "Segmento", type: "select", options: ["Proximal", "Medio", "Distal"] },
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text", default: "0%" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "puente_intramiocardico", label: "Puente Intramiocárdico", type: "text" },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        },
                        {
                            groupName: "ada_ramas",
                            title: "Ramas de la ADA",
                            repeatable: true,
                            fields: [
                                { name: "rama", label: "Rama", type: "select", options: ["Primera Rama Diagonal", "Segunda Rama Diagonal", "Tercera Rama Diagonal"] },
                                { name: "origen", label: "Origen", type: "text" },
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text", default: "0%" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        },
                        {
                            groupName: "ramus_intermedio",
                            title: "Arteria del Ramus Intermedio",
                            repeatable: false,
                            fields: [
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text", default: "0%" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        },
                        {
                            groupName: "acx_segments",
                            title: "Arteria Circunfleja (ACX) - Segmentos",
                            repeatable: true,
                            fields: [
                                { name: "segmento", label: "Segmento", type: "select", options: ["Proximal", "Medio", "Distal"] },
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text", default: "0%" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        },
                        {
                            groupName: "acx_ramas",
                            title: "Ramas de la ACX",
                            repeatable: true,
                            fields: [
                                { name: "rama", label: "Rama", type: "select", options: ["Primera Rama Marginal Obtusa", "Segunda Rama Marginal Obtusa"] },
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text", default: "0%" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        }
                    ]
                },
                {
                    title: "Arteriografía Coronaria No Invasiva - Arteria Coronaria Derecha",
                    fields: [
                        { name: "acd_dominancia", label: "Dominancia", type: "select", options: ["Dominante", "No Dominante", "Co-Dominante"] },
                        { name: "acd_ostium", label: "Ostium y Nacimiento", type: "text", default: "Normal. Trayecto normal" }
                    ],
                    repeatableGroups: [
                        {
                            groupName: "acd_segments",
                            title: "Arteria Coronaria Derecha (ACD) - Segmentos",
                            repeatable: true,
                            fields: [
                                { name: "segmento", label: "Segmento", type: "select", options: ["Proximal", "Medio", "Distal"] },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text", default: "0%" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        },
                        {
                            groupName: "acd_ramas",
                            title: "Ramas de la Arteria Coronaria Derecha",
                            repeatable: true,
                            fields: [
                                { name: "rama", label: "Rama", type: "select", options: ["Arteria Conal y Arteria para el Nodo AV", "Rama Marginal Aguda", "Rama Interventricular Posterior", "Rama Posterolateral"] },
                                { name: "origen", label: "Origen", type: "text" },
                                { name: "calibre_desarrollo", label: "Calibre y Desarrollo", type: "text" },
                                { name: "ateromatosis", label: "Ateromatosis", type: "text", default: "0%" },
                                { name: "compromiso_luminal", label: "Compromiso Luminal", type: "text" },
                                { name: "obstruccion", label: "% de Obstrucción", type: "number", default: 0, suggestComment: true },
                                { name: "artefacto", label: "Presencia de Artefacto", type: "text" }
                            ]
                        }
                    ]
                },
                {
                    title: "Conclusiones Angio TC Cardiaco Multidetector",
                    fields: [
                        { name: "conclusiones", label: "Conclusiones Generales", type: "textarea" },
                        { name: "cad_rads_display", label: "CAD-RADS Calculado", type: "text", readonly: true }
                    ]
                }
            ]
        };

        // Función para renderizar el formulario dinámicamente
        function renderForm() {
            const form = document.getElementById('report-form');
            form.innerHTML = '';
            reportStructure.sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'mb-6';
                const title = document.createElement('h2');
                title.className = 'text-xl font-semibold mb-2';
                title.textContent = section.title;
                sectionDiv.appendChild(title);

                // Renderizar campos simples
                section.fields.forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'mb-4';
                    const label = document.createElement('label');
                    label.className = 'block text-gray-700 text-lg';
                    label.textContent = field.label;
                    div.appendChild(label);

                    let input;
                    if (field.type === 'select') {
                        input = document.createElement('select');
                        input.className = 'w-full p-3 border rounded-lg text-lg';
                        field.options.forEach(opt => {
                            const option = document.createElement('option');
                            option.value = opt;
                            option.textContent = opt;
                            input.appendChild(option);
                        });
                    } else if (field.type === 'checkbox') {
                        input = document.createElement('input');
                        input.type = 'checkbox';
                        input.className = 'w-6 h-6';
                        label.textContent = field.labelText; // Para checkboxes, label después
                        div.insertBefore(input, label);
                    } else if (field.type === 'textarea') {
                        input = document.createElement('textarea');
                        input.className = 'w-full p-3 border rounded-lg text-lg h-32';
                    } else {
                        input = document.createElement('input');
                        input.type = field.type;
                        input.className = 'w-full p-3 border rounded-lg text-lg';
                        if (field.readonly) input.readOnly = true;
                    }
                    input.id = field.name;
                    input.name = field.name;
                    if (field.default) input.value = field.default;
                    if (field.suggestComment) {
                        input.addEventListener('change', suggestComment);
                    }
                    input.addEventListener('input', saveData);
                    div.appendChild(input);
                    sectionDiv.appendChild(div);
                });

                // Renderizar grupos repetibles
                if (section.repeatableGroups) {
                    section.repeatableGroups.forEach(group => {
                        const groupDiv = document.createElement('div');
                        groupDiv.className = 'mb-4 border p-4 rounded-lg';
                        const groupTitle = document.createElement('h3');
                        groupTitle.className = 'text-lg font-medium mb-2';
                        groupTitle.textContent = group.title;
                        groupDiv.appendChild(groupTitle);

                        const instancesDiv = document.createElement('div');
                        instancesDiv.id = `${group.groupName}-instances`;
                        groupDiv.appendChild(instancesDiv);

                        if (group.repeatable) {
                            const addBtn = document.createElement('button');
                            addBtn.type = 'button';
                            addBtn.className = 'bg-indigo-500 text-white px-4 py-2 rounded-lg text-lg hover:bg-indigo-600';
                            addBtn.textContent = `Añadir ${group.title}`;
                            addBtn.onclick = () => addRepeatableInstance(group, instancesDiv);
                            groupDiv.appendChild(addBtn);
                        } else {
                            addRepeatableInstance(group, instancesDiv, false);
                        }
                        sectionDiv.appendChild(groupDiv);
                    });
                }

                form.appendChild(sectionDiv);
            });
            loadData();
            updatePreview();
            calculateCADRADS();
        }

        // Función para añadir instancia repetible
        let instanceCounter = {};
        function addRepeatableInstance(group, container, addRemove = true) {
            const groupName = group.groupName;
            if (!instanceCounter[groupName]) instanceCounter[groupName] = 0;
            instanceCounter[groupName]++;
            const instanceId = `${groupName}-${instanceCounter[groupName]}`;

            const instanceDiv = document.createElement('div');
            instanceDiv.className = 'mb-4 border-t pt-2';
            instanceDiv.id = instanceId;

            group.fields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'mb-2';
                const label = document.createElement('label');
                label.className = 'block text-gray-700 text-lg';
                label.textContent = field.label;
                div.appendChild(label);

                let input;
                if (field.type === 'select') {
                    input = document.createElement('select');
                    input.className = 'w-full p-3 border rounded-lg text-lg';
                    field.options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt;
                        option.textContent = opt;
                        input.appendChild(option);
                    });
                } else if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                    input.className = 'w-full p-3 border rounded-lg text-lg h-24';
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                    input.className = 'w-full p-3 border rounded-lg text-lg';
                }
                input.name = `${instanceId}-${field.name}`;
                if (field.default) input.value = field.default;
                if (field.suggestComment) {
                    input.addEventListener('change', suggestComment);
                }
                input.addEventListener('input', saveData);
                div.appendChild(input);
                instanceDiv.appendChild(div);
            });

            if (addRemove) {
                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'bg-red-500 text-white px-4 py-2 rounded-lg text-lg hover:bg-red-600 mt-2';
                removeBtn.textContent = 'Eliminar Instancia';
                removeBtn.onclick = () => {
                    instanceDiv.remove();
                    saveData();
                    updatePreview();
                    calculateCADRADS();
                };
                instanceDiv.appendChild(removeBtn);
            }

            container.appendChild(instanceDiv);
        }

        // Sugerir comentarios basados en % de obstrucción
        function suggestComment(event) {
            const input = event.target;
            const value = parseInt(input.value);
            let suggestion = '';
            if (value === 0) suggestion = 'No presenta ateromatosis';
            else if (value < 25) suggestion = 'Ateromatosis mínima';
            else if (value < 50) suggestion = 'Ateromatosis leve';
            else if (value < 70) suggestion = 'Ateromatosis moderada';
            else if (value < 100) suggestion = 'Ateromatosis severa';
            else if (value === 100) suggestion = 'Oclusión total';

            // Buscar textarea o text cercano para sugerir
            const parent = input.closest('div.mb-6') || document;
            const commentField = parent.querySelector('textarea, input[type="text"][name*="ateromatosis"], input[type="text"][name*="compromiso"]');
            if (commentField) commentField.value = suggestion;

            updatePreview();
            calculateCADRADS();
        }

        // Calcular CAD-RADS automáticamente
        function calculateCADRADS() {
            let maxObstruction = 0;
            let modifiers = [];
            const obstructionInputs = document.querySelectorAll('input[name*="obstruccion"]');
            obstructionInputs.forEach(input => {
                const val = parseInt(input.value) || 0;
                if (val > maxObstruction) maxObstruction = val;
                // Detectar modificadores: e.g., si tronco, multivaso
                if (input.name.includes('tci') && val > 0) modifiers.push('Tronco coronario involucrado');
                // Asumir multivaso si >1 con >50%
            });

            let cadRads = 0;
            if (maxObstruction === 0) cadRads = 0;
            else if (maxObstruction < 25) cadRads = 1;
            else if (maxObstruction < 50) cadRads = 2;
            else if (maxObstruction < 70) cadRads = 3;
            else if (maxObstruction < 100) cadRads = 4;
            else cadRads = 5;

            // Ajustar por modificadores
            if (modifiers.length > 0 && cadRads >= 4) cadRads = '4b'; // Ejemplo
            else if (cadRads === 4) cadRads = '4a';

            const display = document.getElementById('cad_rads_display');
            if (display) display.value = `CAD-RADS: ${cadRads} según la clasificación... (con recomendaciones)`;
            updatePreview();
        }

        // Guardar datos en localStorage
        function saveData() {
            const formData = new FormData(document.getElementById('report-form'));
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            localStorage.setItem('reportData', JSON.stringify(data));
            updatePreview();
            calculateCADRADS();
        }

        // Cargar datos de localStorage
        function loadData() {
            const savedData = JSON.parse(localStorage.getItem('reportData'));
            if (savedData) {
                Object.keys(savedData).forEach(key => {
                    const input = document.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') input.checked = savedData[key] === 'on';
                        else input.value = savedData[key];
                    }
                });
            }
            updatePreview();
        }

        // Actualizar vista previa
        function updatePreview() {
            const preview = document.getElementById('preview');
            preview.innerHTML = ''; // Limpiar
            // Generar HTML similar al documento original
            const formData = new FormData(document.getElementById('report-form'));
            let html = '<div class="prose max-w-none">';

            reportStructure.sections.forEach(section => {
                html += `<h2>${section.title}</h2>`;
                section.fields.forEach(field => {
                    html += `<p><strong>${field.label}:</strong> ${formData.get(field.name) || field.default || ''}</p>`;
                });
                if (section.repeatableGroups) {
                    section.repeatableGroups.forEach(group => {
                        html += `<h3>${group.title}</h3>`;
                        const instances = document.querySelectorAll(`#${group.groupName}-instances > div`);
                        instances.forEach(instance => {
                            html += '<div class="border p-2 mb-2">';
                            group.fields.forEach(field => {
                                const input = instance.querySelector(`[name*="${field.name}"]`);
                                if (input) html += `<p><strong>${field.label}:</strong> ${input.value}</p>`;
                            });
                            html += '</div>';
                        });
                    });
                }
            });

            html += '</div>';
            preview.innerHTML = html;
        }

        // Precargar escenarios
        document.getElementById('preload-normal').addEventListener('click', () => {
            // Setear valores normales (0% obstrucción, normales)
            document.querySelectorAll('input[type="number"]').forEach(input => input.value = 0);
            document.querySelectorAll('input[type="text"], textarea').forEach(input => input.value = 'Normal / 0% / No presenta');
            saveData();
        });

        document.getElementById('preload-severe').addEventListener('click', () => {
            // Setear valores severos (e.g., 80% en varios)
            document.querySelectorAll('input[name*="obstruccion"]').forEach(input => input.value = 80);
            document.querySelectorAll('input[type="text"][name*="ateromatosis"]').forEach(input => input.value = 'Severa');
            saveData();
        });

        // Generar PDF
        document.getElementById('generate-pdf').addEventListener('click', () => {
            const element = document.getElementById('preview');
            html2pdf().from(element).save('reporte_angiotc.pdf');
        });

        // Inicializar
        renderForm();
    </script>
</body>
</html>
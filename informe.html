<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vivit CardioTools - Informe AngioTC Cardíaco</title>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- D3 for SVG manipulations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Data Structures -->
    <script type="module" src="js/data.js"></script>
    <script type="module" src="js/data/posicionesDominancia.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/informe.css">
</head>

<body>
    <header class="no-print">
        <img src="https://i0.wp.com/vivitsalud.com/wp-content/uploads/2023/01/Diseno-sin-titulo-9.png?w=200&ssl=1" alt="Vivit Salud Logo" class="logo">
        <div style="flex:1">
            <h1>Informe de AngioTC Cardíaco</h1>
            <div class="small" id="report-date"></div>
        </div>
        <div class="controls no-print">
            <button onclick="window.print()">Imprimir</button>
            <button id="download-btn">Descargar HTML</button>
        </div>
    </header>

    <main>
        <!-- Columna Principal (Izquierda) -->
        <div class="main-column">
            <section class="card patient-header">
                <div class="patient-info">
                    <div>
                        <div class="badge">Paciente</div>
                        <h2><span id="patient-name"></span></h2>
                        <div class="small" id="patient-details"></div>
                        <div class="small meta-info">
                            <div><strong>Indicación:</strong> <span id="patient-indication"></span></div>
                            <div><strong>Médico Ref.:</strong> <span id="patient-doctor"></span> (<span id="doctor-specialty"></span>)</div>
                        </div>
                    </div>
                    <div class="patient-id-risk">
                        <div id="patient-id" class="small"></div>
                        <div class="risk-factors-container">
                            <div class="small">Factores de Riesgo</div>
                            <div id="risk-factors"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card coronary-wrap">
                <h3>Mapa Coronario Esquemático <span id="coronary-map-dominance" class="small"></span></h3>
                <div id="coronarySVG" class="coronary-svg-container"></div>
                <div id="legend-container" class="legend"></div>
            </section>

            <section class="card">
                <h3>Hallazgos por Arteria</h3>
                <table id="arteries-table">
                    <thead>
                        <tr>
                            <th>Arteria</th>
                            <th>Hallazgo</th>
                            <th>Localización</th>
                            <th>Estenosis</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>

            <section class="card">
                <h3>Grado de Estenosis Máxima por Segmento</h3>
                <div class="chart-container" style="height: 200px;">
                    <canvas id="stenosisLine"></canvas>
                </div>
            </section>
        </div>

        <!-- Columna Lateral (Derecha) -->
        <div class="sidebar-column">
            <section class="card">
                <h3>CAD-RADS™ 2.0</h3>
                <div class="cad-rads-summary">
                    <div id="cad-rads-score" class="cad-rads-score">N/A</div>
                    <div class="cad-rads-details">
                        <div class="small"><strong>Modificadores:</strong> <span id="cad-rads-modifiers"></span></div>
                        <p class="small" id="cad-rads-description"></p>
                    </div>
                </div>
            </section>

            <section class="card">
                <h3>Conclusión</h3>
                <p class="small" id="conclusion-text"></p>
            </section>

            <section class="card">
                <h3>Score de Calcio (Agatston)</h3>
                <div class="calcium-grid">
                    <div class="calcium-summary">
                        <div class="small">Score Total</div>
                        <div id="calcium-score-total" class="total-score"></div>
                        <div class="small" id="calcium-percentile"></div>
                    </div>
                    <div class="calcium-pie-chart">
                        <canvas id="calcioPie"></canvas>
                    </div>
                </div>
                <div class="legend calcium-legend">
                    <div class="item"><div class="sw" style="background:var(--verde)"></div> Mínimo (1-10)</div>
                    <div class="item"><div class="sw" style="background:var(--amarillo)"></div> Leve (11-100)</div>
                    <div class="item"><div class="sw" style="background:var(--naranja)"></div> Moderado (101-400)</div>
                    <div class="item"><div class="sw" style="background:var(--rojo)"></div> Severo (>400)</div>
                </div>
                <div class="calcium-bar-chart">
                    <canvas id="calcioBar"></canvas>
                </div>
            </section>

            <section class="card">
                <div class="grid-summaries">
                    <div>
                        <h3>Función Ventricular</h3>
                        <div class="chart-container fevi-chart-container">
                            <canvas id="feviChart"></canvas>
                            <div class="small chart-label">FEVI: <strong id="fevi-text"></strong></div>
                        </div>
                    </div>
                    <div>
                        <h3>Aorta Ascendente</h3>
                        <div class="small">Diámetro tubular: <strong id="aorta-diameter"></strong></div>
                        <div class="bar-container">
                            <div class="bar-bg">
                                <div id="aortaBar" class="bar-fg"></div>
                            </div>
                            <div class="small bar-label">Interpretación: <strong id="aorta-interpretation"></strong></div>
                        </div>
                    </div>
                </div>
                <div class="legend">
                    <div class="item"><div class="sw" style="background:var(--verde)"></div> Normal (>55%)</div>
                    <div class="item"><div class="sw" style="background:var(--amarillo)"></div> Leve (45-54%)</div>
                    <div class="item"><div class="sw" style="background:var(--naranja)"></div> Mod. (30-44%)</div>
                    <div class="item"><div class="sw" style="background:var(--rojo)"></div> Sev. (&lt;30%)</div>
                </div>
            </section>

            <section class="card">
                <h3>Anatomía Cardiovascular</h3>
                <div id="cardiac-anatomy" class="small"></div>
            </section>

            <section class="card">
                <h3>Detalles Técnicos del Estudio</h3>
                <div id="technical-details" class="small"></div>
            </section>

            <section class="card">
                <h3>Hallazgos Extracardíacos</h3>
                <p class="small" id="extracardiac-findings"></p>
            </section>
        </div>
    </main>
    
    <div class="report-full-width-container">
        <section id="written-report-container" class="card">
            <!-- El contenido se generará con JavaScript -->
        </section>
    </div>

    <footer>
        Informe generado con Vivit CardioTools — Este informe es una guía y debe ser interpretado por un profesional cualificado.
    </footer>
    <script type="module" src="js/logic/informe.js"></script>
</body>

</html>
